semantic_models:
  # Primary Sales Hierarchy Model
  - name: sales_hierarchy
    description: "Sales hierarchy data representing organizational structure and reporting relationships"
    model: ref('stg_sf_sales_hierarchy')
    defaults:
      agg_time_dimension: dbt_insert_timestamp_utc  # Changed from effective_date
    
    entities:
      - name: hierarchy_id
        type: primary
        expr: hierarchy_id
        description: "Unique identifier for each hierarchy record"
      
      - name: employee_id
        type: unique
        expr: employee_id
        description: "Unique identifier for each employee"

    dimensions:
      - name: dbt_insert_timestamp_utc
        type: time
        expr: dbt_insert_timestamp_utc
        description: "Timestamp when the record was inserted"
        type_params:
          time_granularity: day

      - name: region_name
        type: categorical
        expr: region_name
        description: "Geographic region"

      - name: department_name
        type: categorical
        expr: department_name
        description: "Department name"

      - name: hierarchy_level
        type: categorical
        expr: hierarchy_level
        description: "Level in the organization hierarchy"

  # Opportunity Model
  - name: opportunity
    description: "Sales opportunities data"
    model: ref('stg_sf_opportunity')
    defaults:
      agg_time_dimension: created_date
    
    entities:
      - name: opportunity_id
        type: primary
        expr: opportunity_id
        description: "Unique identifier for each opportunity"
      
      - name: owner_id
        type: foreign
        expr: owner_id  # This joins to sales_hierarchy.employee_id
        description: "ID of the employee who owns the opportunity"

    dimensions:
      - name: created_date
        type: time
        expr: created_date
        description: "Date when the opportunity was created"
        type_params:
          time_granularity: day

      - name: stage_name
        type: categorical
        expr: stage_name
        description: "Current stage of the opportunity"

    measures:
      - name: total_amount
        expr: amount
        agg: sum
        description: "Total opportunity amount"
        agg_time_dimension: created_date

      - name: opportunity_count
        expr: opportunity_id
        agg: count_distinct
        description: "Count of opportunities"
        agg_time_dimension: created_date

metrics:
  - name: total_opportunity_amount
    description: "Total opportunity amount that can be sliced by sales hierarchy dimensions"
    type: simple
    label: "Total Opportunity Amount"
    type_params:
      measure: total_amount